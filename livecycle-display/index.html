<!--
    Output type for gig-discovery chat endpoint (TypeScript):
    --------------------------------------------------------
    type GigDiscoveryChatOutput = {
  data: {
    budget: number; // the budget for the task
    category: "architecture" | "book editing" | "digital marketing" | "missing" | "video editing" | "website design" | "website development";
    deliveryTime: "24h" | "3d" | "7d" | "anytime" | "missing";
    language: "English" | "missing";
    taskDetails: string; // detailed description of the task
    taskType: string; // the type of task the user wants to accomplish
  };
      isInformationComplete: boolean; // indicates if all necessary data is present
      nextMessage: string; // the next message to ask the user for missing data or to thank them for the information
    };
    /*
      Expert type (from experts JSON):
      {
        name: string;
        image: string;
        rating: number;
        reviews: number;
        skills: string[];
        price: number;
        profileUrl: string;
        deliveryTime: string;
        gigs: Array<{ title: string; minPrice: number; }>;
        portfolio: any[];
        // New field:
        aboutMe: string; // Short bio/about the expert
      }
    */

    ========================================================
    # personalized-expert-message Endpoint

    ## Task Description
    Generates a personalized message from an expert to a user based on the user's gig requirements and the expert's profile.

    ## Usage
    POST https://data.livecycle.page/g/QI2te

    ## Input Schema (arktype)
    ```
    {
      data: {
        deliveryTime: string, // the expected delivery time for the task
        task: string, // the type of task requested by the user
        details: string, // additional details about the task
        budget: string, // the budget level for the task
        expertAboutMe: string, // the 'about me' section of the expert
        expertGigList: {
          gigTitle: string, // the title of the gig
          gigDescription: string // the description of the gig
        }[] // list of gigs offered by the expert
      }
    }
    ```

    ## Example Input
    ```
    {
      data: {
        budget: "Medium",
        deliveryTime: "5 days",
        details: "I need a modern, responsive website for my small business, including a contact form and integration with social media. I have a logo and some images, but I need help with the overall design and layout.",
        expertAboutMe: "I'm a professional web developer with over 8 years of experience building custom websites for businesses of all sizes. I specialize in creating visually appealing, user-friendly, and mobile-responsive sites that help clients grow their online presence.",
        expertGigList: [
          {
            gigDescription: "I will design and develop a custom WordPress website tailored to your business needs, including up to 5 pages, contact form, and basic SEO.",
            gigTitle: "Custom WordPress Website Development"
          },
          {
            gigDescription: "I will redesign your existing website to improve its look, usability, and performance, ensuring it is mobile-friendly and optimized for search engines.",
            gigTitle: "Website Redesign and Optimization"
          },
          {
            gigDescription: "I will provide ongoing website maintenance, updates, and technical support to keep your site running smoothly.",
            gigTitle: "Website Maintenance and Support"
          }
        ],
        task: "Website design and development"
      }
    }
    ```

    ## Output Schema (JSON Schema)
    ```
    {
      data: {
        personalizedMessage: string, // a personalized message from the expert to the user (UI: ~4 lines)
        relevantGigTitle: string // the title of the most relevant gig, or a fallback if none is found
      }
    }
    ```
    --><!DOCTYPE html><html lang="en"><head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K5HJ679');</script>
<!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Perfect Fiverr Expert | Chat Assistant</title>

    <!-- Fiverr Fonts -->
    <style>
        @font-face {
            font-family: "Macan";
            src: url("assets/502483a0eb7a0109bba05fbd9b3743e7.woff2") format("woff2");
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: "Macan";
            src: url("assets/3d263b5d897300221339f211f2b74e5e.woff2") format("woff2");
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: "Macan";
            src: url("assets/d147812d01ddb77d6c271d088b816751.woff2") format("woff2");
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: "Macan";
            src: url("assets/9b72a311bb35194ff57bd6276ffbe2e7.woff2") format("woff2");
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
    </style>

    <!-- Tailwind CSS -->
    
    <!-- Alpine.js -->
    <script defer="" src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    

    <style>
        .chat-scroll {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .chat-scroll::-webkit-scrollbar {
            display: none;
        }
        
        .expert-card-swipe {
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
            cursor: grab;
            user-select: none;
        }
        .expert-card-swipe.dragging {
            cursor: grabbing;
        }
        .expert-card-swipe::-webkit-scrollbar {
            display: none;
        }
        .expert-card {
            scroll-snap-align: center;
        }
        /* Smooth transition for chat interface */
        [x-cloak] { display: none !important; }
        /* Skeleton shimmer for loading expert cards */
        .skeleton {
            position: relative;
            overflow: hidden;
            background-color: #f3f3f3;
        }
        .skeleton::after {
            content: "";
            display: block;
            position: absolute;
            top: 0; left: 0; height: 100%; width: 100%;
            background: linear-gradient(90deg, rgba(243,243,243,0) 0%, rgba(220,220,220,0.7) 50%, rgba(243,243,243,0) 100%);
            animation: shimmer 1.2s infinite;
        }
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
  <script type="text/javascript">
  (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&((a=a[b[0]]),(d=b[1]));a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)));};}var a=b;"undefined"!==typeof c?(a=b[c]=[]):(c="mixpanel");a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d;};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2]);};}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d;};b._i.push([e,f,c]);};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g);}})(document,window.mixpanel||[]);
  mixpanel.init("85e4a78448be5212958bd77a4aa38257", { track_pageview: true });
  </script><link rel="stylesheet" href="styles-b321e8423d9a0d6bba6fc70f45a9e5a3.css">
    <script>
      window.lucide = {
        createIcons: ()=>{}
      }
    </script>
  </head>

<body class="font-macan bg-gray-100 min-h-screen flex flex-col">
  <div class="flex-1 flex flex-col justify-center items-center w-full min-h-screen">
    <div class="w-full h-full flex flex-col
      bg-white shadow-none border-none min-h-screen
      md:max-w-lg md:mx-auto md:my-8 md:rounded-3xl md:shadow-xl md:border md:border-gray-200
      md:h-[80vh] md:min-h-[600px] md:flex-none
      transition-all duration-300
      ">
      <!-- Header Section -->
      <header id="header" class="bg-white shadow-sm border-b border-gray-100 px-4 py-3 flex items-center justify-between relative z-10 md:rounded-t-3xl md:shadow-none md:border-b md:border-gray-200">
          <div class="flex items-center space-x-3">
              <img src="assets/df852837e67bfdb312ac8a8d453525f0.webp" alt="Fiverr" class="h-6" decoding="async" style="aspect-ratio: 291 / 87">
              <div class="text-sm font-semibold text-neutral-heading">Expert Finder</div>
          </div>
         <button onclick="resetChat()" class="text-neutral-light hover:text-neutral-heading transition-colors" data-anx-event="reset_chat" data-anx-props-action="reset" data-anx-props-scope="header">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
          </button>
      </header>

      <!-- Main Chat Interface -->
      <main id="chat-interface" class="flex flex-col flex-1 min-h-0" x-data="chatApp()">
        <!-- Centralized Initial Message Box -->
        <template x-if="showInitialInput">
          <section class="flex-1 flex flex-col justify-center items-center px-4 py-6 min-h-[400px]">
            <form @submit.prevent="submitInitialMessage()" class="w-full max-w-md">
              <div class="flex flex-col items-center">
                <div class="mb-6 text-center">
                  <div class="text-2xl font-semibold text-neutral-heading mb-2">What do you need help with?</div>
                  <div class="text-base text-neutral-text">Describe your project or task. Iâ€™ll help you find the perfect expert.</div>
                </div>
                <textarea x-model="initialMessage" :placeholder="animatedPlaceholder" class="w-full px-6 py-5 rounded-2xl border border-gray-200 shadow-lg focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary text-lg transition-all duration-300 resize-none" :disabled="isProcessing" rows="3" autofocus="" @keydown.enter="handleInitialInputEnter($event)" x-init="startPlaceholderTyping()"></textarea>
                <button type="submit" :disabled="!initialMessage.trim() || isProcessing" class="mt-6 w-full bg-primary text-white py-3 rounded-2xl font-semibold text-lg hover:bg-opacity-90 transition-all duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed" data-anx-event="send_message" data-anx-props-action="send" data-anx-props-scope="initial_input">
                  <span x-show="!isProcessing">Start</span>
                  <span x-show="isProcessing">Processing...</span>
                </button>
              </div>
            </form>
          </section>
        </template>

        <!-- Chat Messages Container -->
        <section id="chat-messages" x-show="!showInitialInput" x-transition:enter="transition-all duration-500 ease-in-out" x-transition:enter-start="opacity-0 translate-y-10" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition-all duration-500 ease-in-out" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 translate-y-10" class="flex-1 overflow-y-auto chat-scroll px-4 py-6 space-y-4 relative" x-ref="chatContainer" style="height: calc(100% - 80px);">
            <!-- Dynamic Messages -->
            <template x-for="message in messages" :key="message.id">
                <div class="flex" :class="message.type === 'user' ? 'justify-end' : 'justify-start'">
                    <!-- User Message -->
                    <div x-show="message.type === 'user'" class="bg-primary text-white rounded-2xl rounded-br-md px-4 py-3 max-w-xs shadow-sm">
                        <div class="text-sm" x-text="message.content"></div>
                    </div>

                    <!-- System Message -->
                    <div x-show="message.type === 'system'" class="bg-white rounded-2xl rounded-bl-md px-4 py-3 max-w-xs shadow-sm border border-gray-100">
                        <div class="text-sm text-neutral-heading font-medium mb-1">Fiverr Assistant</div>
                        <div class="text-sm text-neutral-text" x-text="message.content"></div>
                    </div>

                    <!-- Processing Message -->
                    <div x-show="message.type === 'processing'" class="bg-white rounded-2xl rounded-bl-md px-4 py-3 max-w-xs shadow-sm border border-gray-100">
                        <div class="text-sm text-neutral-heading font-medium mb-1">Fiverr Assistant</div>
                        <div class="flex items-center space-x-2">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                                <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                                <div class="w-2 h-2 bg-primary rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                            </div>
                            <span class="text-sm text-neutral-text" x-text="message.content"></span>
                        </div>
                    </div>

                    <!-- Loading Experts Placeholder -->
                    <div x-show="message.type === 'loading-experts'" class="w-full">
                        <div class="bg-white rounded-2xl rounded-bl-md px-4 py-3 shadow-sm border border-gray-100 mb-4">
                            <div class="text-sm text-neutral-heading font-medium mb-1">Fiverr Assistant</div>
                            <div class="text-sm text-neutral-text flex items-center space-x-2">
                                <svg class="animate-spin h-4 w-4 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
                                <span x-text="friendlyLoadingExpertMessage"></span>
                            </div>
                        </div>
                        <div class="relative">
                            <div class="expert-card-swipe flex overflow-x-auto space-x-4 pb-4">
                                <template x-for="i in 3" :key="'skeleton-' + i">
                                    <div class="expert-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                                        <div class="relative h-64 skeleton"></div>
                                        <div class="p-4">
                                            <div class="flex items-center justify-between mb-2">
                                                <div class="h-4 w-24 skeleton rounded"></div>
                                                <div class="h-3 w-16 skeleton rounded"></div>
                                            </div>
                                            <div class="mb-2">
                                                <div class="h-3 w-20 skeleton rounded"></div>
                                            </div>
                                            <div class="h-3 w-56 skeleton rounded mb-2"></div>
                                            <div class="h-3 w-40 skeleton rounded mb-3"></div>
                                            <div class="flex flex-wrap gap-1 mb-4">
                                                <div class="h-4 w-14 skeleton rounded-full"></div>
                                                <div class="h-4 w-12 skeleton rounded-full"></div>
                                                <div class="h-4 w-10 skeleton rounded-full"></div>
                                            </div>
                                            <div class="h-10 w-full skeleton rounded-lg"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Experts Gallery -->
                    <div x-show="message.type === 'experts'" class="w-full">
                        <div class="bg-white rounded-2xl rounded-bl-md px-4 py-3 shadow-sm border border-gray-100 mb-4">
                            <div class="text-sm text-neutral-heading font-medium mb-1">Fiverr Assistant</div>
                            <div class="text-sm text-neutral-text">Perfect! I found the best experts for your project. Swipe through to see their profiles:</div>
                        </div>
                        
                        <!-- Expert Cards Swipe Gallery -->
                        <div class="relative">
                            <div class="expert-card-swipe flex overflow-x-auto space-x-4 pb-4" x-ref="expertGallery">
                                <template x-for="(expert, index) in message.experts" :key="expert.name">
                                    <div class="expert-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                                        <!-- Expert Image -->
                                        <div class="relative h-64 bg-gradient-to-br from-primary to-primary-dark">
                                            <img :src="expert.photo" :alt="expert.name" class="w-full h-full object-cover" style="object-position: top;" @error="Array.isArray(message.experts) &amp;&amp; message.experts.splice(index, 1)">
                                            <div class="absolute top-4 right-4 bg-white rounded-full px-2 py-1 flex items-center space-x-1">
                                                <svg class="w-3 h-3 text-yellow-400 fill-current" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"></path></svg>
                                                <span class="text-xs font-semibold" x-text="expert.rating"></span>
                                            </div>
                                        </div>

                                        <!-- Expert Info -->
                                        <div class="p-4">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="font-semibold text-neutral-heading" x-text="expert.name"></h3>
                                                <div class="text-xs text-neutral-light" x-text="expert.reviewsCount > 1000 ? (Math.round(expert.reviewsCount/100)/10 + 'K reviews') : (expert.reviewsCount + ' reviews')"></div>
                                            </div>

                                            <!-- Price Section -->
                                            <div class="mb-2">
                                                <span class="text-xs text-neutral-light">Price:&nbsp;</span>
                                                <span class="text-sm font-semibold text-primary" x-text="expert.price !== null ? ('$' + Math.round(expert.price)) : 'N/A'"></span>
                                                <template x-if="$root &amp;&amp; $root.projectData &amp;&amp; $root.projectData.price">
                                                    <span class="text-xs text-neutral-light">&nbsp;|&nbsp;Your Budget: <span class="font-semibold text-accent-pink" x-text="'$' + Math.round($root.projectData.price)"></span></span>
                                                </template>
                                            </div>

                                            <!-- USP -->
                                            <p class="text-sm text-neutral-text mb-3 line-clamp-4" x-text="expert.personalizedUSP"></p>

                                            <!-- Skills -->
                                            <div class="flex flex-wrap gap-1 mb-4">
                                                <template x-if="Array.isArray(expert.skills)">
                                                    <template x-for="skill in expert.skills.slice(0, 3)" :key="skill">
                                                        <span class="px-2 py-1 bg-accent-beige text-accent-pink text-xs rounded-full font-medium" x-text="skill"></span>
                                                    </template>
                                                </template>
                                                <span x-show="Array.isArray(expert.skills) &amp;&amp; expert.skills.length > 3" class="px-2 py-1 bg-gray-100 text-neutral-light text-xs rounded-full" x-text="Array.isArray(expert.skills) ? ('+' + (expert.skills.length - 3) + ' more') : ''"></span>
                                            </div>

                                            <!-- CTA Link to Expert Profile -->
                                            <a :href="expert.profileUrl" target="_blank" rel="noopener noreferrer" class="w-full inline-block text-center bg-primary text-white py-3 rounded-lg font-semibold hover:bg-opacity-90 transition-all duration-200 transform hover:scale-105" data-anx-event="view_profile" data-anx-props-action="view" data-anx-props-scope="expert_card" :data-anx-props-profileurl="expert.profileUrl">
                                                View Profile
                                            </a>
                                            <template x-if="false"></template>
                                            <!-- PATCH: add expert profile as property to view_profile event -->
                                            <a x-ref="profileLink" :href="expert.profileUrl" target="_blank" rel="noopener noreferrer" class="hidden" data-anx-event="view_profile" data-anx-props-action="view" data-anx-props-scope="expert_card" :data-anx-props-profile="JSON.stringify({
                                                   name: expert.name,
                                                   photo: expert.photo,
                                                   rating: expert.rating,
                                                   reviewsCount: expert.reviewsCount,
                                                   personalizedUSP: expert.personalizedUSP,
                                                   skills: expert.skills,
                                                   price: expert.price,
                                                   profileUrl: expert.profileUrl,
                                                   deliveryTime: expert.deliveryTime,
                                                   gigs: expert.gigs,
                                                   portfolio: expert.portfolio,
                                                   aboutMe: expert.aboutMe
                                               })">
                                            </a>
                                            
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- Gallery Indicators -->
                            <div class="flex justify-center space-x-2 mt-4" x-show="message.experts &amp;&amp; message.experts.length > 1">
                                <template x-for="(expert, index) in message.experts" :key="'indicator-' + index">
                                    <button type="button" class="w-2 h-2 rounded-full transition-colors duration-200 focus:outline-none" :class="currentExpertIndex === index ? 'bg-primary' : 'bg-gray-300'" :aria-label="'Go to expert ' + (index + 1)" @click="handleIndicatorClick(index)" :tabindex="window.matchMedia('(pointer: fine)').matches ? 0 : -1" style="cursor: pointer;"></button>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Typing Indicator -->
            <div x-show="isTyping" class="flex justify-start">
                <div class="bg-white rounded-2xl rounded-bl-md px-4 py-3 max-w-xs shadow-sm border border-gray-100">
                    <div class="text-sm text-neutral-heading font-medium mb-1">Fiverr Assistant</div>
                    <div class="flex items-center space-x-1">
                        <div class="w-2 h-2 bg-neutral-light rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                        <div class="w-2 h-2 bg-neutral-light rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                        <div class="w-2 h-2 bg-neutral-light rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Input Section -->
        <section id="chat-input" class="bg-white border-t border-gray-100 p-4 sticky bottom-0 w-full z-10" x-show="!showInitialInput &amp;&amp; !isComplete">
            <form @submit.prevent="sendMessage()" class="flex space-x-3">
                <div class="flex-1 relative">
                    <input type="text" x-model="currentMessage" :disabled="isProcessing" placeholder="Type your message..." class="w-full px-4 py-3 border border-gray-200 rounded-2xl focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary disabled:bg-gray-50 disabled:text-gray-400" :class="isProcessing ? 'cursor-not-allowed' : ''">
                </div>
                <button type="submit" :disabled="!currentMessage.trim() || isProcessing" class="bg-primary text-white p-3 rounded-2xl hover:bg-opacity-90 transition-all duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95" data-anx-event="send_message" data-anx-props-action="send" data-anx-props-scope="chat_input">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"></path><path d="m21.854 2.147-10.94 10.939"></path></svg>
                </button>
            </form>
        </section>

        <!-- Success Section -->
        <section id="success-section" class="bg-white border-t border-gray-100 p-4 text-center" x-show="isComplete">
            <div class="text-primary mb-2">
                <svg class="w-8 h-8 mx-auto" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg>
            </div>
            <div class="text-sm text-neutral-heading font-semibold mb-1">Expert Selected!</div>
            <div class="text-xs text-neutral-text mb-4">You can now contact your chosen expert on Fiverr.</div>
            <button @click="resetChat()" class="bg-primary text-white px-6 py-2 rounded-lg text-sm font-semibold hover:bg-opacity-90 transition-all duration-200" data-anx-event="find_another_expert" data-anx-props-action="reset" data-anx-props-scope="success_section">
                Find Another Expert
            </button>
        </section>
      </main>
    </div>
  </div>

  <!-- Lucide Icons -->
  

  <script>
        function chatApp() {
            return {
                // UI state
                showInitialInput: true,
                initialMessage: '',
                messages: [],
                currentMessage: '',
                isTyping: false,
                isProcessing: false,
                isComplete: false,
                chatHistory: [],
                currentExpertIndex: 0,
                indicatorScrollLock: false,
                // For rotating friendly loading expert messages
                friendlyLoadingExpertMessage: "Finding the best experts for you...",
                _friendlyLoadingExpertMessages: [
                    "Finding the best experts for you...",
                    "Matching your project with top talent...",
                    "Almost there! Assembling your expert list...",
                    "Hang tight, your perfect experts are on the way!",
                    "Reviewing profiles to find your ideal match..."
                ],
                _friendlyLoadingExpertInterval: null,
                _friendlyLoadingExpertIdx: 0,
                animatedPlaceholder: "",
                _placeholderExamples: [
                    "I need a new Shopify store for my business by the end of the week, preferably under $100",
                    "Edit my book and provide feedback within 3 days",
                    "Help me design a modern logo for my startup",
                    "Create a 60-second marketing video in English"
                ],
                _placeholderInterval: null,
                _placeholderExampleIndex: 0,
                _placeholderTypingTimeout: null,
                _placeholderTypingSpeed: 18, // ms per character (faster)
                _placeholderPauseBetween: 900, // ms pause between examples

                init() {
                    this.scrollToBottom();
                    lucide.createIcons();
                    this.startPlaceholderTyping();
                },

                startPlaceholderTyping() {
                    // If user already started typing, don't animate placeholder
                    if (this.initialMessage && this.initialMessage.length > 0) {
                        this.animatedPlaceholder = "";
                        return;
                    }
                    this.animatedPlaceholder = "";
                    if (this._placeholderInterval) {
                        clearInterval(this._placeholderInterval);
                        this._placeholderInterval = null;
                    }
                    if (this._placeholderTypingTimeout) {
                        clearTimeout(this._placeholderTypingTimeout);
                        this._placeholderTypingTimeout = null;
                    }
                    const examples = this._placeholderExamples;
                    let exampleIdx = 0;
                    const typeNextExample = () => {
                        if (this.initialMessage && this.initialMessage.length > 0) {
                            this.animatedPlaceholder = "";
                            return;
                        }
                        const full = examples[exampleIdx];
                        let i = 0;
                        this.animatedPlaceholder = "";
                        if (this._placeholderInterval) {
                            clearInterval(this._placeholderInterval);
                        }
                        // Typing animation
                        this._placeholderInterval = setInterval(() => {
                            if (this.initialMessage && this.initialMessage.length > 0) {
                                this.animatedPlaceholder = "";
                                clearInterval(this._placeholderInterval);
                                this._placeholderInterval = null;
                                return;
                            }
                            if (i <= full.length) {
                                this.animatedPlaceholder = full.slice(0, i);
                                i++;
                            } else {
                                clearInterval(this._placeholderInterval);
                                this._placeholderInterval = null;
                                // Pause, then simulate deleting at 3x speed
                                this._placeholderTypingTimeout = setTimeout(() => {
                                    let delIdx = full.length;
                                    const deleteSpeed = Math.max(1, Math.floor(this._placeholderTypingSpeed / 3));
                                    this._placeholderInterval = setInterval(() => {
                                        if (this.initialMessage && this.initialMessage.length > 0) {
                                            this.animatedPlaceholder = "";
                                            clearInterval(this._placeholderInterval);
                                            this._placeholderInterval = null;
                                            return;
                                        }
                                        if (delIdx >= 0) {
                                            this.animatedPlaceholder = full.slice(0, delIdx);
                                            delIdx--;
                                        } else {
                                clearInterval(this._placeholderInterval);
                                this._placeholderInterval = null;
                                // Immediately type next example after deletion
                                exampleIdx = (exampleIdx + 1) % examples.length;
                                typeNextExample();
                                        }
                                    }, deleteSpeed);
                                }, this._placeholderPauseBetween);
                            }
                        }, this._placeholderTypingSpeed);
                    };
                    typeNextExample();
                },

                submitInitialMessage() {
                    if (!this.initialMessage.trim() || this.isProcessing) return;
                    // Explicitly dispatch analytics for Start (send_message) if not triggered by click
                    if (window.anx && typeof window.anx.track === 'function') {
                        window.anx.track('send_message', {action: 'send', scope: 'initial_input'});
                    }
                    const msg = this.initialMessage.trim();
                    this.initialMessage = '';
                    this.showInitialInput = false;
                    // Add as first user message
                    this.addMessage('user', msg);
                    this.chatHistory.push({
                        message: msg,
                        timestamp: new Date().toISOString(),
                        role: 'user'
                    });
                    // Process with API
                    this.processWithAPI();
                },

                async sendMessage() {
                    if (!this.currentMessage.trim() || this.isProcessing) return;

                    const userMessage = this.currentMessage.trim();
                    this.currentMessage = '';

                    // Add user message to UI
                    this.addMessage('user', userMessage);

                    // Add to chat history as user message
                    this.chatHistory.push({
                        message: userMessage,
                        timestamp: new Date().toISOString(),
                        role: 'user'
                    });

                    // Process with API
                    await this.processWithAPI();
                },

                async processWithAPI() {
                    this.isProcessing = true;
                    
                    // Add processing message
                    const processingMsg = this.addMessage('processing', 'Analyzing your requirements...');

                    try {
                        // gig-discovery-data-extraction Endpoint
                        // POST https://data.livecycle.page/g/oxTxT
                        // Input: { data: { chatHistory: [ { message, timestamp, role }, ... ] } }
                        const response = await fetch('https://data.livecycle.page/g/oxTxT', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                data: {
                                    chatHistory: this.chatHistory
                                }
                            })
                        });

                        const result = await response.json();
                        
                        // Remove processing message
                        this.removeMessage(processingMsg.id);

                        // The new output schema: result.data.data, result.data.isInformationComplete, result.data.nextMessage
                        if (result.data && result.data.isInformationComplete === true) {
                            // Information is complete, fetch experts
                            // Add assistant message to chatHistory
                            if (result.data.nextMessage) {
                                this.chatHistory.push({
                                    message: result.data.nextMessage,
                                    timestamp: new Date().toISOString(),
                                    role: 'assistant'
                                });
                            }
                            await this.fetchExperts(result.data.data);
                        } else {
                            // Need more information
                            const assistantMsg = result.data && result.data.nextMessage ? result.data.nextMessage : "Could you provide more details about your project?";
                            this.addMessage('system', assistantMsg);
                            // Add assistant message to chatHistory
                            this.chatHistory.push({
                                message: assistantMsg,
                                timestamp: new Date().toISOString(),
                                role: 'assistant'
                            });
                        }

                    } catch (error) {
                        console.error('API Error:', error);
                        this.removeMessage(processingMsg.id);
                        this.addMessage('system', 'Sorry, I encountered an error. Please try again.');
                        // Add error message to chatHistory as assistant
                        this.chatHistory.push({
                            message: 'Sorry, I encountered an error. Please try again.',
                            timestamp: new Date().toISOString(),
                            role: 'assistant'
                        });
                    }

                    this.isProcessing = false;
                },

                async fetchExperts(projectData) {
                    // Add animated loading placeholder for experts
                    // Start rotating friendly loading messages
                    this.startFriendlyLoadingExpertMessages();
                    const loadingMsg = this.addMessage('loading-experts', '');
                    // Prepare input for new Fiverr expert recommendation endpoint
                    const apiInput = {
                        data: {
                            budget: typeof projectData.budget === "number" ? `$${projectData.budget}` : (projectData.budget || ""),
                            category: projectData.category || "",
                            deliveryTime: projectData.deliveryTime || "",
                            language: projectData.language || "English",
                            taskDetails: projectData.taskDetails || "",
                            taskType: projectData.taskType || ""
                        }
                    };
                    // Fire analytics event for starting search
                    if (window.anx && typeof window.anx.track === "function") {
                        window.anx.track('start_search', {
                            ...apiInput.data
                        });
                    }
                    let apiResult = null;
                    let errorOccurred = false;
                    // Ensure at least 1s loading for nice effect
                    const minLoadingMs = 1000;
                    const start = Date.now();
                    try {
                        const response = await fetch('https://data.livecycle.page/g/EwwCx', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(apiInput)
                        });
                        apiResult = await response.json();
                    } catch (error) {
                        errorOccurred = true;
                        console.error('Experts API Error:', error);
                    }
                    const elapsed = Date.now() - start;
                    if (elapsed < minLoadingMs) {
                        await new Promise(res => setTimeout(res, minLoadingMs - elapsed));
                    }
                    // Stop rotating loading messages
                    this.stopFriendlyLoadingExpertMessages();
                    this.removeMessage(loadingMsg.id);
                    if (errorOccurred || !apiResult || !apiResult.data || !Array.isArray(apiResult.data) || apiResult.data.length === 0) {
                        this.addMessage('system', 'Sorry, I couldn\'t find experts for your project right now. Please try again.');
                        return;
                    }
                    // Map the API result to the UI format
                    const topExperts = apiResult.data.map(expert => ({
                        name: expert.name,
                        photo: typeof expert.photo === "string" && expert.photo.includes("t_profile_small")
                            ? expert.photo.replace("t_profile_small", "t_profile_original")
                            : expert.photo,
                        rating: expert.rating,
                        reviewsCount: expert.reviewCount,
                        personalizedUSP: expert.personalizedUSP,
                        skills: expert.skills || [],
                        price: typeof expert.price === "number" ? expert.price : null,
                        profileUrl: expert.profileUrl || null,
                        deliveryTime: null,
                        gigs: [],
                        portfolio: [],
                        aboutMe: ""
                    }));
                    this.addMessage('experts', '', topExperts);
                    // Fire analytics event for showing results
                    if (window.anx && typeof window.anx.track === "function") {
                        window.anx.track('show_results', {
                            ...apiInput.data,
                            result_count: Array.isArray(topExperts) ? topExperts.length : 0
                        });
                    }
                    this.$nextTick(() => {
                        this.setupGalleryScroll();
                        lucide.createIcons();
                    });
                },

                addMessage(type, content, experts = null) {
                    const message = {
                        id: Date.now() + Math.random(),
                        type,
                        content,
                        experts,
                        timestamp: new Date()
                    };
                    
                    this.messages.push(message);
                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });
                    
                    return message;
                },

                removeMessage(messageId) {
                    this.messages = this.messages.filter(msg => msg.id !== messageId);
                },

                selectExpert(expert) {
                    this.addMessage('system', `Great choice! ${expert.name} is an excellent expert for your project. You can now contact them on Fiverr to get started.`);
                    this.isComplete = true;
                    this.$nextTick(() => {
                        this.scrollToBottom();
                    });
                },

                setupGalleryScroll() {
                    const gallery = this.$refs.expertGallery;
                    if (!gallery) return;
                    // Gallery scroll indicator logic
                    gallery.addEventListener('scroll', () => {
                        const cardWidth = gallery.querySelector('.expert-card')?.offsetWidth || 0;
                        const scrollLeft = gallery.scrollLeft;
                        const newIndex = Math.round(scrollLeft / (cardWidth + 16)); // 16 is the gap
                        this.currentExpertIndex = Math.max(0, Math.min(newIndex, gallery.children.length - 1));
                    });

                    // Enable drag-to-scroll for desktop (pointer: fine)
                    if (window.matchMedia('(pointer: fine)').matches) {
                        let isDown = false;
                        let startX;
                        let scrollLeft;

                        gallery.addEventListener('mousedown', (e) => {
                            // Only left mouse button
                            if (e.button !== 0) return;
                            isDown = true;
                            gallery.classList.add('dragging');
                            startX = e.pageX - gallery.offsetLeft;
                            scrollLeft = gallery.scrollLeft;
                            e.preventDefault();
                        });
                        gallery.addEventListener('mouseleave', () => {
                            isDown = false;
                            gallery.classList.remove('dragging');
                        });
                        gallery.addEventListener('mouseup', () => {
                            isDown = false;
                            gallery.classList.remove('dragging');
                        });
                        gallery.addEventListener('mousemove', (e) => {
                            if (!isDown) return;
                            e.preventDefault();
                            const x = e.pageX - gallery.offsetLeft;
                            const walk = (x - startX); // px moved
                            gallery.scrollLeft = scrollLeft - walk;
                        });
                    }
                },

                scrollToBottom() {
                    const container = this.$refs.chatContainer;
                    if (container) {
                        const shouldScroll = container.scrollTop + container.clientHeight >= container.scrollHeight - 100;
                        if (shouldScroll) {
                            container.scrollTop = container.scrollHeight;
                        }
                    }
                    this.$nextTick(() => {
                        const container = this.$refs.chatContainer;
                        if (container) {
                            container.scrollTop = container.scrollHeight;
                        }
                    });
                },

                handleInitialInputEnter(e) {
                    if (e.shiftKey) {
                        // Allow newline
                        return;
                    }
                    e.preventDefault();
                    this.submitInitialMessage();
                },
                resetChat() {
                    this.messages = [];
                    this.chatHistory = [];
                    this.currentMessage = '';
                    this.initialMessage = '';
                    this.showInitialInput = true;
                    this.isTyping = false;
                    this.isProcessing = false;
                    this.isComplete = false;
                    this.currentExpertIndex = 0;
                    this.animatedPlaceholder = "";
                    this.stopFriendlyLoadingExpertMessages();
                    this.startPlaceholderTyping();
                },
                // Rotating friendly loading expert messages
                startFriendlyLoadingExpertMessages() {
                    if (this._friendlyLoadingExpertInterval) {
                        clearInterval(this._friendlyLoadingExpertInterval);
                        this._friendlyLoadingExpertInterval = null;
                    }
                    this._friendlyLoadingExpertIdx = 0;
                    this.friendlyLoadingExpertMessage = this._friendlyLoadingExpertMessages[0];
                    this._friendlyLoadingExpertInterval = setInterval(() => {
                        this._friendlyLoadingExpertIdx = (this._friendlyLoadingExpertIdx + 1) % this._friendlyLoadingExpertMessages.length;
                        this.friendlyLoadingExpertMessage = this._friendlyLoadingExpertMessages[this._friendlyLoadingExpertIdx];
                    }, 2200);
                },
                stopFriendlyLoadingExpertMessages() {
                    if (this._friendlyLoadingExpertInterval) {
                        clearInterval(this._friendlyLoadingExpertInterval);
                        this._friendlyLoadingExpertInterval = null;
                    }
                    this.friendlyLoadingExpertMessage = this._friendlyLoadingExpertMessages[0];
                }
                ,
                handleIndicatorClick(index) {
                    // Only allow click on desktop (pointer: fine)
                    if (!window.matchMedia('(pointer: fine)').matches) return;
                    const gallery = this.$refs.expertGallery;
                    if (!gallery) return;
                    const card = gallery.querySelectorAll('.expert-card')[index];
                    if (!card) return;
                    // Scroll so that the card is centered in the gallery
                    const cardWidth = card.offsetWidth;
                    const gap = 16; // px, matches space-x-4
                    const scrollTo = index * (cardWidth + gap);
                    this.indicatorScrollLock = true;
                    gallery.scrollTo({ left: scrollTo, behavior: 'smooth' });
                    // Prevent scroll event from updating index mid-animation
                    setTimeout(() => { this.indicatorScrollLock = false; }, 400);
                    this.currentExpertIndex = index;
                }
            }
        }

        // Global reset function
        function resetChat() {
            location.reload();
        }

        // Initialize icons when page loads
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
    </script>


<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K5HJ679"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<script>
(function() {
  // List of important query params to forward
  const TRACKING_PARAMS = [
    'utm_source',
    'utm_medium',
    'utm_campaign',
    'utm_term',
    'utm_content',
    'gclid',
    'fbclid',
    'msclkid'
    // Add more if needed
  ];

  // Get tracking params from the current URL
  function getTrackingParams() {
    const params = new URLSearchParams(window.location.search);
    const trackingParams = {};
    for (const key of params.keys()) {
      if (TRACKING_PARAMS.includes(key)) {
        trackingParams[key] = params.get(key);
      }
    }
    return trackingParams;
  }

  // Append tracking params to a given URL
  function appendTrackingParams(url, trackingParams) {
    if (!Object.keys(trackingParams).length) return url;
    try {
      const newUrl = new URL(url, window.location.origin);
      for (const key in trackingParams) {
        newUrl.searchParams.set(key, trackingParams[key]);
      }
      return newUrl.toString();
    } catch (e) {
      // Invalid URLs (mailto:, tel:, etc.)
      return url;
    }
  }

  // Update all links on the page
  function updateLinks(trackingParams) {
    document.querySelectorAll('a[href]').forEach(link => {
      const href = link.getAttribute('href');
      if (!href || href.startsWith('#') || href.startsWith('javascript:') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
      link.href = appendTrackingParams(href, trackingParams);
    });
  }

  const trackingParams = getTrackingParams();

  // Initial link update on page load
  document.addEventListener('DOMContentLoaded', function() {
    updateLinks(trackingParams);
  });

  // Observe dynamic DOM changes (for dynamically loaded links)
  const observer = new MutationObserver(mutations => {
    mutations.forEach(mutation => {
      mutation.addedNodes.forEach(node => {
        if (node.nodeType === 1) { // Element node
          if (node.tagName === 'A' && node.hasAttribute('href')) {
            updateLinks(trackingParams);
          } else if (node.querySelectorAll) {
            if (node.querySelectorAll('a[href]').length > 0) {
              updateLinks(trackingParams);
            }
          }
        }
      });
    });
  });

  observer.observe(document.body, { childList: true, subtree: true });
})();
</script><script id="anx-script-v1">
window.anx = {
    init: (track, globalProps = { pagename: window.location.pathname }) => {
        window.anx.track = track
        requestAnimationFrame(()=> {
            window.anx.addLinksTracking({
                forceTarget: window.anx.opts.forceATarget
            })
        })
        document.addEventListener('click', function (e) {
            const isHref = e.target.tagName === 'A' && e.target.hasAttribute('href');
            let target = e.target.closest('[data-anx-event]');
            if (!target) return; // Only if element has data-anx-event

            let eventName = target.getAttribute('data-anx-event');
            let props = { ...globalProps };

            // Collect all data-anx-props-* attributes
            Array.from(target.attributes).forEach(attr => {
            if (attr.name.startsWith('data-anx-props-')) {
                const propName = attr.name.replace('data-anx-props-', '');
                props[propName] = attr.value;
            }
            });

            // Check for external link
            const isLink = target.tagName === 'A' && target.hasAttribute('href');
            const href = isLink ? target.getAttribute('href') : null;
            const isExternal = isLink && href && !href.startsWith("#") && !href.includes(window.location.host) && !target.hasAttribute('target');

            if (isExternal) {
            // Prevent immediate navigation
            e.preventDefault();

            // Send event to tracker, then redirect
            track(eventName, props);
            setTimeout(function () {
                window.location = href;
            }, 300);
            } else {
            // Send event to tracker for non-external or other elements
            track(eventName, props);
            }
        });
    },
    addLinksTracking: (opts = {}) => {
        document.querySelectorAll('a[href]').forEach(a => {
            if (opts.forceTarget){
                if (!a.hasAttribute('target')){
                    a.setAttribute('target', '_blank')
                }
            }
            const closest = a.closest('[data-anx-event]')
            if (closest) return
            a.setAttribute('data-anx-event', 'link_click')
            a.setAttribute('data-anx-props-scope', 'page')
            a.setAttribute('data-anx-props-action', 'navigate')
            a.setAttribute('data-anx-props-href', a.href)
            a.setAttribute('data-anx-props-label', (a.textContent || '').substring(0, 30) )
            
            return;
        })
    }
};

window.anx.trackers = {
    console: (...args) => console.log("event", ...args),
    mixpanel: (...args) => mixpanel.track(...args),
    gtm: (eventName, props) => {
        if (!window.dataLayer) {
            return
        }
        window.dataLayer.push({
            event: eventName,
            ...props
        })
    }
}

window.anx.opts = {"forceATarget":true}
window.anx.activeTrackers = ["mixpanel","gtm","console"]
window.anx.variables = {"pageName":"chat-seller"}

window.anx.init((...args) => {
    window.anx.activeTrackers.forEach(tracker => {
        window.anx.trackers[tracker](...args)
    })
}, window.anx.variables);
</script></body></html>